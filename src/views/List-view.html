<ion-page>
    <ion-header>
        <ion-toolbar>
            <ion-title>
                <i18next :translation="$t('listView.title')">
                    <template #transportType>
                        <span>{{ $t(`common.${type}`) }}</span>
                    </template>
                </i18next>
            </ion-title>
            <ion-buttons slot="end">
                <ion-button @click="openNews" data-testid="open-news">
                    <ion-icon :icon="newspaperOutline"></ion-icon>
                </ion-button>
                <ion-button @click="openOption" data-tesid="open-option">
                    <ion-icon :icon="cog"></ion-icon>
                </ion-button>
            </ion-buttons>
        </ion-toolbar>
    </ion-header>
    <ion-content :fullscreen="true">
        <ion-modal
            ref="modal"
            :is-open="optionIsOpen"
            @WillDismiss="closeOption"
        >
            <OptionView @closeOption="closeOption" />
        </ion-modal>
        <ion-list v-if="dataReady">
            <!-- Change List Header according to bus search -->
            <ion-list-header>
                <ion-label class="hint">{{ $t('listView.hint') }}</ion-label>
            </ion-list-header>
            <!-- Bus route display list here -->
            <div v-for="(route, index) in data" :key="route.id">
                <ion-item v-if="route.direction == 1" button>
                    <ion-grid>
                        <!-- Row Button for MTR -->
                        <ion-row
                            v-if="route.type == 'mtr'"
                            class="open-modal"
                            expand="block"
                            @click="openModal(index)"
                        >
                            <ion-col
                                size-xs="3"
                                size-md="1"
                                class="route-no ion-align-items-center"
                            >
                                <div
                                    class="line-color-indicator"
                                    :style="{
                                            'background-color':
                                                '#' + route.color,
                                        }"
                                ></div>
                            </ion-col>
                            <ion-col size-xs="9" size-md="11">
                                <h5
                                    v-if="$i18next.language === 'zh'"
                                    class="ion-no-margin ion-margin-start ion-padding-vertical"
                                >
                                    {{ route.routeNameTC }}
                                </h5>
                                <h5
                                    v-else
                                    class="ion-no-margin ion-margin-start ion-padding-vertical"
                                >
                                    {{ route.routeNameEN }}
                                </h5>
                            </ion-col>
                        </ion-row>
                        <!-- Row Button for lightRail -->
                        <ion-row
                            v-if="route.type == 'lightRail'"
                            class="open-modal"
                            expand="block"
                            @click="openModal(index)"
                        >
                            <ion-col
                                size-xs="3"
                                size-md="1"
                                class="route-no ion-align-items-center"
                            >
                                <h5>{{ route.routeId }}</h5>
                            </ion-col>
                            <ion-col size-xs="9" size-md="11">
                                <h5
                                    v-if="$i18next.language === 'zh'"
                                    class="ion-no-margin ion-margin-start ion-padding-vertical"
                                >
                                    {{ route.originTC }} - {{ route.destTC }}
                                </h5>
                                <h5
                                    v-else
                                    class="ion-no-margin ion-margin-start ion-padding-vertical"
                                >
                                    {{ route.originEN }} - {{ route.destEN }}
                                </h5>
                            </ion-col>
                        </ion-row>
                        <!-- Row Button for Tram -->
                        <ion-row
                            v-if="route.type == 'tram'"
                            class="open-modal"
                            expand="block"
                            @click="openModal(index)"
                        >
                            <ion-col size-xs="8" size-md="10">
                                <h5
                                    v-if="$i18next.language === 'zh'"
                                    class="ion-no-margin ion-margin-start ion-padding-vertical"
                                >
                                    {{ route.routeNameTC }}
                                </h5>
                                <h5
                                    v-else
                                    class="ion-no-margin ion-margin-start ion-padding-vertical"
                                >
                                    {{ route.routeNameEN }}
                                </h5>
                            </ion-col>
                            <ion-col size-xs="2" size-md="1" class="d-flex">
                                <ion-button
                                    @click.stop="openModal(index)"
                                    class="direction1-button direction-button"
                                    >{{ $t('listView.westbound') }}</ion-button
                                >
                            </ion-col>
                            <ion-col size-xs="2" size-md="1" class="d-flex">
                                <ion-button
                                    @click.stop="openAltModal(index)"
                                    class="direction2-button direction-button"
                                    >{{ $t('listView.eastbound') }}</ion-button
                                >
                            </ion-col>
                        </ion-row>
                    </ion-grid>
                </ion-item>
            </div>
        </ion-list>
    </ion-content>
    <!-- Modal for displaying bus details -->
    <ion-modal :is-open="modalIsOpen" ref="modal" @WillDismiss="closeModal">
        <ETAPopup
            :item="itemSelected"
            :noEta="checkNoEta"
            :altRoutes="altRoutes"
            @closeModal="closeModal"
            @swapDirection="swapDirection"
        />
    </ion-modal>
    <ion-modal :is-open="newsIsOpen" @WillDismiss="closeNews">
        <News @closeNews="closeNews" />
    </ion-modal>
</ion-page>
